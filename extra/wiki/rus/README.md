# LocalTrack  
  
Это устройство является GPS логгером (регистратором) с открытыми исходными файлами (прошивка и плата).  
Вы устанавливаете его с помощью встроенных магнитов на какой-либо автомобиль, включаете и данные  
сохраняются во внутреннюю флэш-память. После того, как некоторые маршруты были записаны, вы можете  
снова забрать устройство и извлечь GPX файлы маршрутов через USB. Затем вы можете загрузить эти  
файлы в программу для картографирования/анализа данных по вашему выбору, например [viking](https://sourceforge.net/projects/viking), чтобы  
получить информацию о маршрутах в максимально удобном виде.  
  
![outside](https://github.com/krakrukra/LocalTrack/blob/master/extra/photos/outside.jpg)  
![inside](https://github.com/krakrukra/LocalTrack/blob/master/extra/photos/inside.jpg)  
  
Это устройство предназначено для использования в ситуациях, где не требуется отслеживание в реальном  
времени, но желательны другие преимущества устройства без подключения к сети, такие как:  
  
1. Не нужно платить своему оператору сотовой связи.  
  
2. Файлы хранятся в устройстве, поэтому вам не придется доверять свои данные каким-то проприетарным  
программам производителя и не придётся зависеть от предоставляемых им услуг.  
  
3. Регистратор труднее обнаружить; если его обнаружат, трудно отследить, откуда он взялся,  
поскольку с ним не связана такая информация, как IMEI, IMSI, история платежей, итд.  
  
4. Меньшее энергопотребление и более длительный срок службы батареи.  
  
**ИНСТРУКЦИЯ ПО ПРИМЕНЕНИЮ ЕСТЬ НА [ВИКИ](https://github.com/krakrukra/LocalTrack/blob/master/extra/wiki/rus/home.md)**  
  
---
  
## аппаратная часть  
  
Проект разработан с использованием KiCad 6.0.11.  
Изчите pcb файл KiCad для информации по печатной плате  
Изучите BOM.txt и sch файл KiCad для информации по деталям  
  
Используется встроенное переферийное устройство USB2.0 full-speed (12Мбит/с),  
а также чип памяти дающий ёмкость в 96МиБ для хранения файлов.  
Измеренная скорость доступа к диску: чтение 800-850КиБ/c, запись 700-750 КиБ/с  
  
В собранном виде устройство имеет размеры 85х55х32мм и вес 175 грамм.  
Программатор используемый для прошивки устройства - [ST-Link V2](https://www.aliexpress.com/item/1823628996.html)  
  
SIM28 выпускается в нескольких вариантах, которые по умолчанию имеют разные скорости USART.  
Прошивка устройства ожидает версию со скоростью 9600 бит/c. Если у вас другая версия модуля  
вам нужно будет изменить конфигурацию USART1 в файлах main.c и peripherals.c  
  
Устройство оснащено литий-ионным аккумулятором ёмкостью 3000 мАч и работает при напряжении выше 3 В.  
Если обнаружено более низкое напряжение, устройство переходит в режим разряженной батареи и ждет,  
пока аккумулятор будет заряжен. Потребление тока в рабочем режиме составляет около 40 мА;  
во время ожидания в спящем режиме (например, из-за отсутствия движения) оно составляет менее 1 мА.  
Это обеспечивает около 70 часов активного отслеживания, прежде чем батарея разрядится.  
Аккумулятор можно заряжать через USB током до 1 А, поэтому обязательно выбирайте  
подходящий адаптер для зарядки и USB-кабель. Также имейте в виду, что вам понадобится  
кабель с удлинённым разъёмом micro-USB длиной 8 мм вместо обычного разъёма длиной 5,4 мм.  
  
## прошивка  
  
язык программирования = C  
ПО для прошивки = openocd 0.12.0  
среда разработки = emacs + Makefile  
  
Прошивка разработана на системе debian 11.3 с использованием пакета gcc-arm-none-eabi  
(компилятор, компоновщик, бинарные утилиты) и использует расширения компилятора gcc.  
Она была успешно скомпилирована и протестирована с arm-none-eabi-gcc версии 12.2.1  
  
Имеет зависимость от библиотеки libgcc.a, она содержится в репозитории. Скрипт  
компоновщика, стартовый код, и файлы конфигурации openocd также содержатся в нём.  
  
Для записи прошивки можно использовать DFU загрузчик. В репозитории есть dfu  
образ прошивки в файле **/firmware/firmware\_RRNNN.dfu**; название записано в  
таком формате: RR - это версия платы (13 = плата 1.3) , NNN - это версия прошивки.  
Например, firmware\_13002.dfu это файл для платы версии 1.3 с прошивкой версии 2.  
  
  
Для автоматизации процесса компиляции применяется утилита make. Если вы откроете  
командную строку в каталоге **/firmware/** вы сможете запустить эти команды:  
  
> make  
> make upload  
> make dfu  
> make clean  
  
"make" компилирует исходный код и создает несколько файлов, среди которых  
есть firmware.bin который и нужно записать в память устройства. "make upload"  
через программатор ST-Link V2 запишет этот файл. Для этого нужно заранее  
правильно подключить плату к программатору, а затем и сам программатор к ПК.  
"make dfu" создаёт из firmware.bin образ dfu для загрузчика, который потом  
можно будет использовать для прошивки без программатора. "make clean"  
удалит все временные и промежуточные файлы созданные предыдущими командами.  
  
## содержание каталогов  
  
#### /firmware/ ------------- содержит makefile, скрипт компоновщика, исходный код, промежуточные файлы  
/firmware/cmsis/ ------- заголовочные файлы из CMSIS библиотеки [STM32F0xx standard peripherals](https://www.st.com/content/st_com/en/products/embedded-software/mcus-embedded-software/stm32-embedded-software/stm32-standard-peripheral-libraries/stsw-stm32048.html)  
/firmware/stdlib/ ---------- стандартные статические библиотеки (libgcc.a)  
/firmware/openocd/ ------- стандартные файлы конфигурации для openocd 0.12.0  
/firmware/fatfs/ ---------- библиотека файловой системы [chan fatfs](http://www.elm-chan.org/fsw/ff/00index_e.html) + собственный драйвер W25N01GVZEIG  
/firmware/usb/ ------------ собственный USB стек, реализация устройства MSD класса  
/firmware/main/ ------- основаная программа, таблица адресов прерываний, стартовый код, функции прерывний  
/firmware/dfuse-pack.py ------- скрипт в python для создания .dfu образов прошивки  
/firmware/linkScript.ld ------- специальный скрипт для GNU компоновщика (ld)  
/firmware/Makefile ------- файл используемый утилитой автоматизации GNU make  
/firmware/firmware_13NNN.dfu ------ заранее скомпилированный образ прошивки в формате DfuSe (STM32)  
  
#### /hardware/ -------------------содержит KiCad проект, файлы схемы и печатной платы  
/hardware/LocalTrack.symbols/ ---- библиотека символов для схемы проекта  
/hardware/LocalTrack.pretty/ ----- библиотека деталей для платы проекта  
/hardware/gerbers/ ----------- gerber+excellon файлы для производства  
/hardware/BOM.txt --------- список деталей для самостоятельной закупки и сборки  
  
#### /mechanical/ ------------------- содержит механическую информацию по устройству  
/mechanical/drawings/ ---- чертежи используемых деталей  
/mechanical/KH-F20.FCStd --- freecad модель пластикового корпуса  
  
#### /extra/ -------------------  содержит картинки, документы, итд.  
/extra/photos/ ---------------- фото устройства  
/extra/wiki/ ------------------ страницы вики для github  
  
## контактная информация  
  
Если у вас есть проблема / вопрос / предложение, то вот несколько способов связаться со мной:  
отправьте email на krakrukra@tutanota.com  
создайте новый вопрос на github (сначала проверьте [уже закрытые](https://github.com/krakrukra/LocalTrack/issues?q=is%3Aissue+is%3Aclosed))  
также можно использовать соцсети, например мой [канал на youtube](https://www.youtube.com/channel/UC8HZCV1vNmZvp7ci1vNmj7g),  
[группу ВК](https://vk.com/krakrukra) или мой [телеграм канал](https://t.me/krakrukra)  
  
#### где купить:  
  
Купить можно напрямую связавшись со мной (например через email) или через авито:  
ССЫЛКА НА СТРАНИЦУ ТОВАРА  
  